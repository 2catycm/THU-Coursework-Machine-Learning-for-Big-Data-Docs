<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="叶璨铭 (2024214500) ycm24@mails.tsinghua.edu.cn">

<title>深入探索方差分析 (Analysis of Variance, ANOVA) – THU-Coursework-Machine-Learning-for-Big-Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../thu_logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="深入探索方差分析 (Analysis of Variance, ANOVA) – THU-Coursework-Machine-Learning-for-Big-Data">
<meta property="og:description" content="大数据分析B课程第一次实验项目">
<meta property="og:site_name" content="THU-Coursework-Machine-Learning-for-Big-Data">
<meta name="twitter:title" content="深入探索方差分析 (Analysis of Variance, ANOVA) – THU-Coursework-Machine-Learning-for-Big-Data">
<meta name="twitter:description" content="大数据分析B课程第一次实验项目">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">THU-Coursework-Machine-Learning-for-Big-Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../theory_assignments/index.html" aria-current="page"> 
<span class="menu-text">理论作业 Theory Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../coding_projects/index.html"> 
<span class="menu-text">代码项目 Coding Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.xuetangx.com/course/THU08091001026/1515437"> 
<span class="menu-text">关于课程 Course Information</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/Open-Book-Studio"> 
<span class="menu-text">关于我们 About Us</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-discuss-with-us" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">和我们一起讨论 Discuss with Us</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-discuss-with-us">    
        <li>
    <a class="dropdown-item" href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/issues"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">你的作业有地方写错了 Report an Issue on Assignments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="http://qm.qq.com/cgi-bin/qm/qr?wv=1027&amp;k=v0Vpqbr4pScRi4IkFK3dsDUCzvu-BtX&amp;authKey=vyojwISealVovwzm6TQR7bkawm4oj6Wgbe4YBheQjRU5XOllK9pQ57eQjaG30dlq&amp;noverify=0&amp;group_code=935310031"><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">X9高校人工智能技术讨论 X9 AI Tech Discussion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/2catycm"><i class="bi bi-question-circle" role="img">
</i> 
 <span class="dropdown-text">联系我们 Contact Us</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Open-Book-Studio"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/THU-CVML"> <i class="bi bi-github" role="img" aria-label="THU-CVML 课题组">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../coding_projects/index.html">coding_projects</a></li><li class="breadcrumb-item"><a href="../../coding_projects/P1_ANOVA/anova.html">P1_ANOVA</a></li><li class="breadcrumb-item"><a href="../../coding_projects/P1_ANOVA/anova.html">深入探索方差分析 (Analysis of Variance, ANOVA)</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">THU-Coursework-Machine-Learning-for-Big-Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../help (library information).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Library Information</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../coding_projects/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">coding_projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">P1_ANOVA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P1_ANOVA/anova.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">深入探索方差分析 (Analysis of Variance, ANOVA)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">P1_KNN</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P1_KNN/kd_tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">深入探索KD树数据结构实现的KNN算法及其在手写数字识别中的应用</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">P2_SVM</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P2_SVM/00svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">更高效的支持向量机算法实现及其在手写数字识别中的应用——00绪论</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P2_SVM/use_lib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">更高效的支持向量机算法实现及其在手写数字识别中的应用——01调库实现SVM手写数字识别</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P2_SVM/handy_crafted_linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">更高效的支持向量机算法实现及其在手写数字识别中的应用——02手动实现SGD优化的软间隔线性SVM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P2_SVM/kernel_hpo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">更高效的支持向量机算法实现及其在手写数字识别中的应用——03不同Kernel的SVM超参数优化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/P2_SVM/handy_crafted_kernel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">更高效的支持向量机算法实现及其在手写数字识别中的应用——04手动实现使用SMO的Kernel SVM</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">big_data_analytics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">P2_Matrix-Decomposition</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_projects/big_data_analytics/P2_Matrix-Decomposition/decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">深入探索基于矩阵分解和协同过滤的个性化推荐系统及其在Netflix电影推荐中的应用</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../theory_assignments/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">theory_assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">A1</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A1/p_assignment1_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">从数据集中进行分布参数估计: 以伯努利分布为例</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">A2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A2/p_assignment2_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">大数据机器学习课程第二次作业</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">A3</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A3/p_assignment3_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">朴素贝叶斯与决策树的深入理解</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">A4</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A4/p_assignment4_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">最大熵模型以及对数几率分类模型的深入理解</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">A5</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A5/p_assignment5_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">支持向量机的深入理解</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">A6</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../theory_assignments/A6/p_assignment6_yecanming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AdaBoost算法的深入理解</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul>
  <li><a href="#代码与文档格式说明" id="toc-代码与文档格式说明" class="nav-link active" data-scroll-target="#代码与文档格式说明"><span class="header-section-number">1</span> 代码与文档格式说明</a></li>
  <li><a href="#recall-and-write-down-the-assumptions-which-one-way-anova-are-based-on." id="toc-recall-and-write-down-the-assumptions-which-one-way-anova-are-based-on." class="nav-link" data-scroll-target="#recall-and-write-down-the-assumptions-which-one-way-anova-are-based-on."><span class="header-section-number">2</span> 1. Recall and write down the assumptions which one-way ANOVA are based on.</a></li>
  <li><a href="#state-the-null-h0-and-the-alternative-h1-hypotheses" id="toc-state-the-null-h0-and-the-alternative-h1-hypotheses" class="nav-link" data-scroll-target="#state-the-null-h0-and-the-alternative-h1-hypotheses"><span class="header-section-number">3</span> 2. State the null (H0) and the alternative (H1) hypotheses</a></li>
  <li><a href="#use-my-favorite-statistics-analysis-software." id="toc-use-my-favorite-statistics-analysis-software." class="nav-link" data-scroll-target="#use-my-favorite-statistics-analysis-software."><span class="header-section-number">4</span> 3. Use my favorite statistics analysis software.</a>
  <ul>
  <li><a href="#a-draw-the-empirical-probability-density-function-and-test-normality" id="toc-a-draw-the-empirical-probability-density-function-and-test-normality" class="nav-link" data-scroll-target="#a-draw-the-empirical-probability-density-function-and-test-normality"><span class="header-section-number">4.1</span> 3.a Draw the empirical probability density function and Test normality</a>
  <ul class="collapse">
  <li><a href="#文件读取" id="toc-文件读取" class="nav-link" data-scroll-target="#文件读取"><span class="header-section-number">4.1.1</span> 文件读取</a></li>
  <li><a href="#经验pdf绘制" id="toc-经验pdf绘制" class="nav-link" data-scroll-target="#经验pdf绘制"><span class="header-section-number">4.1.2</span> 经验pdf绘制</a></li>
  <li><a href="#正态性检验" id="toc-正态性检验" class="nav-link" data-scroll-target="#正态性检验"><span class="header-section-number">4.1.3</span> 正态性检验</a></li>
  </ul></li>
  <li><a href="#b-test-the-normality-of-each-components-and-test-the-homogeneity-of-variances" id="toc-b-test-the-normality-of-each-components-and-test-the-homogeneity-of-variances" class="nav-link" data-scroll-target="#b-test-the-normality-of-each-components-and-test-the-homogeneity-of-variances"><span class="header-section-number">4.2</span> 3.b Test the normality of each components and test the homogeneity of variances</a>
  <ul class="collapse">
  <li><a href="#正态性检验-1" id="toc-正态性检验-1" class="nav-link" data-scroll-target="#正态性检验-1"><span class="header-section-number">4.2.1</span> 正态性检验</a></li>
  <li><a href="#方差齐性检验" id="toc-方差齐性检验" class="nav-link" data-scroll-target="#方差齐性检验"><span class="header-section-number">4.2.2</span> 方差齐性检验</a></li>
  </ul></li>
  <li><a href="#c-do-the-one-way-anova-test-for-col7-with-categories-in-col2." id="toc-c-do-the-one-way-anova-test-for-col7-with-categories-in-col2." class="nav-link" data-scroll-target="#c-do-the-one-way-anova-test-for-col7-with-categories-in-col2."><span class="header-section-number">4.3</span> 3.c Do the one-way ANOVA test for Col[7] with categories in Col[2].</a></li>
  <li><a href="#anova_oneway" id="toc-anova_oneway" class="nav-link" data-scroll-target="#anova_oneway"><span class="header-section-number">4.4</span> anova_oneway</a></li>
  </ul></li>
  <li><a href="#find-another-three-columns-and-test-whether-they-follow-the-anova-assumptions." id="toc-find-another-three-columns-and-test-whether-they-follow-the-anova-assumptions." class="nav-link" data-scroll-target="#find-another-three-columns-and-test-whether-they-follow-the-anova-assumptions."><span class="header-section-number">5</span> 4. Find another three columns and test whether they follow the ANOVA assumptions.</a>
  <ul>
  <li><a href="#经验分布" id="toc-经验分布" class="nav-link" data-scroll-target="#经验分布"><span class="header-section-number">5.1</span> 经验分布</a></li>
  <li><a href="#draw_hist" id="toc-draw_hist" class="nav-link" data-scroll-target="#draw_hist"><span class="header-section-number">5.2</span> draw_hist</a></li>
  <li><a href="#正态性检验-2" id="toc-正态性检验-2" class="nav-link" data-scroll-target="#正态性检验-2"><span class="header-section-number">5.3</span> 正态性检验</a></li>
  <li><a href="#test_normality_group" id="toc-test_normality_group" class="nav-link" data-scroll-target="#test_normality_group"><span class="header-section-number">5.4</span> test_normality_group</a>
  <ul class="collapse">
  <li><a href="#方差齐性检验-1" id="toc-方差齐性检验-1" class="nav-link" data-scroll-target="#方差齐性检验-1"><span class="header-section-number">5.4.1</span> 方差齐性检验</a></li>
  </ul></li>
  <li><a href="#homogeneity_of_variance" id="toc-homogeneity_of_variance" class="nav-link" data-scroll-target="#homogeneity_of_variance"><span class="header-section-number">5.5</span> homogeneity_of_variance</a></li>
  </ul></li>
  <li><a href="#how-to-do-one-way-anova-with-the-non-normal-data" id="toc-how-to-do-one-way-anova-with-the-non-normal-data" class="nav-link" data-scroll-target="#how-to-do-one-way-anova-with-the-non-normal-data"><span class="header-section-number">6</span> 5. How to do one-way ANOVA with the non-normal data?</a>
  <ul>
  <li><a href="#a-find-and-list-the-possible-solutions-set." id="toc-a-find-and-list-the-possible-solutions-set." class="nav-link" data-scroll-target="#a-find-and-list-the-possible-solutions-set."><span class="header-section-number">6.1</span> 5.a Find and list the possible solutions set.</a></li>
  <li><a href="#b-do-the-one-way-anova-on-the-3-columns-you-choose.-do-these-feature-columns-vary-significantly-visualize-the-results." id="toc-b-do-the-one-way-anova-on-the-3-columns-you-choose.-do-these-feature-columns-vary-significantly-visualize-the-results." class="nav-link" data-scroll-target="#b-do-the-one-way-anova-on-the-3-columns-you-choose.-do-these-feature-columns-vary-significantly-visualize-the-results."><span class="header-section-number">6.2</span> 5.b Do the one-way ANOVA on the 3 columns you choose. Do these feature columns vary significantly? Visualize the results.</a>
  <ul class="collapse">
  <li><a href="#直接进行-anova-分析" id="toc-直接进行-anova-分析" class="nav-link" data-scroll-target="#直接进行-anova-分析"><span class="header-section-number">6.2.1</span> 直接进行 ANOVA 分析</a></li>
  </ul></li>
  <li><a href="#auto_anova_for_df" id="toc-auto_anova_for_df" class="nav-link" data-scroll-target="#auto_anova_for_df"><span class="header-section-number">6.3</span> auto_anova_for_df</a></li>
  <li><a href="#draw_box" id="toc-draw_box" class="nav-link" data-scroll-target="#draw_box"><span class="header-section-number">6.4</span> draw_box</a>
  <ul class="collapse">
  <li><a href="#应用解决办法2采用不对数据要求那么严格的假设检验方法" id="toc-应用解决办法2采用不对数据要求那么严格的假设检验方法" class="nav-link" data-scroll-target="#应用解决办法2采用不对数据要求那么严格的假设检验方法"><span class="header-section-number">6.4.1</span> 应用解决办法2——采用不对数据要求那么严格的假设检验方法</a></li>
  </ul></li>
  <li><a href="#auto_friedman_for_df" id="toc-auto_friedman_for_df" class="nav-link" data-scroll-target="#auto_friedman_for_df"><span class="header-section-number">6.5</span> auto_friedman_for_df</a></li>
  <li><a href="#auto_kruskal_for_df" id="toc-auto_kruskal_for_df" class="nav-link" data-scroll-target="#auto_kruskal_for_df"><span class="header-section-number">6.6</span> auto_kruskal_for_df</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/issues/new" class="toc-action"><i class="bi bi-github"></i>反馈问题</a></li></ul></div><div class="quarto-alternate-formats"><h2>其他格式</h2><ul><li><a href="anova.html.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="anova.html.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../coding_projects/index.html">coding_projects</a></li><li class="breadcrumb-item"><a href="../../coding_projects/P1_ANOVA/anova.html">P1_ANOVA</a></li><li class="breadcrumb-item"><a href="../../coding_projects/P1_ANOVA/anova.html">深入探索方差分析 (Analysis of Variance, ANOVA)</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">深入探索方差分析 (Analysis of Variance, ANOVA)</h1>
<p class="subtitle lead">大数据分析B课程第一次实验项目</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>叶璨铭 (2024214500) ycm24@mails.tsinghua.edu.cn </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024年11月6日星期三</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p><img src="../../thu_sigs_logo.png" alt="清华深研院-横" style="zoom:50%;"></p>
<section id="代码与文档格式说明" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="代码与文档格式说明"><span class="header-section-number">1</span> 代码与文档格式说明</h2>
<p>本文档使用Jupyter Notebook编写，所以同时包括了实验文档和实验代码。</p>
<p>本次实验项目采用了 Quarto + nbdev 的系统来发布Jupyter Notebook, 因而我们的实验文档导出为pdf和html格式可以进行阅读，而我们的代码也导出为python模块形式，可以作为代码库被其他项目使用。</p>
<p>我们这样做的好处是，避免单独管理一堆 .py 文件，防止代码冗余和同步混乱，py文件和pdf文件都是从.ipynb文件导出的，可以保证实验文档和代码的一致性。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
重要
</div>
</div>
<div class="callout-body-container callout-body">
<p>可以通过以下命令安装我们实验的代码：</p>
<pre class="shell"><code>pip install git+https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data.git
pip install matplotlib seaborn openpyxl scipy statsmodels</code></pre>
<p>我们的代码导出为了python模块形式，通过以下命令导入：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> thu_big_data_ml.big_data_analytics.anova <span class="im">import</span> <span class="op">*</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
重要
</div>
</div>
<div class="callout-body-container callout-body">
<p>本文档具有一定的交互性，建议使用浏览器打开html文件，这样比pdf文件阅读体验更佳。</p>
</div>
</div>
</section>
<section id="recall-and-write-down-the-assumptions-which-one-way-anova-are-based-on." class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="recall-and-write-down-the-assumptions-which-one-way-anova-are-based-on."><span class="header-section-number">2</span> 1. Recall and write down the assumptions which one-way ANOVA are based on.</h2>
<p>我们首先复习一下课件和上课的笔记：</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="anova_files/figure-html/cell-6-1-image.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>可知，one way ANOVA的<strong>假设</strong>（什么情况下可以进行该分析）是</p>
<ol type="1">
<li><p>数据独立采样。</p></li>
<li><p>不同组的方差一样。</p></li>
<li><p>每一个组的数据都是服从正态分布。</p></li>
</ol>
<p>课件后面还提到，如果不同组的数据的样本量一样大就更好了，叫做Balanced design</p>
<hr>
<p>其中有些我们课上还没听懂的<strong>疑难问题</strong>，列出如下：</p>
<ul>
<li>假设1的问题
<ul>
<li>概率论中独立是什么意思来着？</li>
<li>ANOVA到底要求是谁和谁独立？</li>
</ul></li>
<li>假设2的问题
<ul>
<li>经验法则太经验了吧，不能通过假设检验来确定方差是否相等吗？</li>
<li>老师说的方差不一样时还可以勉强用ANOVA，具体的数据处理方法是什么？</li>
</ul></li>
<li>假设3的问题
<ul>
<li>课上没讲“residuals”是啥？</li>
<li>为什么老师说第三个假设不重要就算不满足也可以做ANOVA，有什么证据吗？</li>
</ul></li>
<li>这三个假设具体在ANOVA后面的分析的哪一步被用到了？</li>
</ul>
</section>
<section id="state-the-null-h0-and-the-alternative-h1-hypotheses" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="state-the-null-h0-and-the-alternative-h1-hypotheses"><span class="header-section-number">3</span> 2. State the null (H0) and the alternative (H1) hypotheses</h2>
<blockquote class="blockquote">
<p>Focus on two columns: Category (Col[2]) and Average Age (Col[7]).</p>
<p>Taking feature Average Age as an example, we want to measure whether the average age varied significantly across the categories. <strong>Clearly state</strong> the null (H0) and the alternative (H1) hypotheses for this task</p>
</blockquote>
<p>依题意，我们需要考察群类型和群员平均年龄的关系，首先假设检验这个关系是否存在。群类型是离散型随机变量，那么有关系就是说不同群类型下的年龄分布有所不同，使用ANOVA的时候，我们就是想说至少他们的均值是不同的。我们认为把实际上年龄分布相同但是被错误认为不同的概率要很小，所以把这个当做一类错误，即错误拒绝零假设的概率。因此，</p>
<ul>
<li>零假设 H0: The mean Average Age (Col[7])s of all Category (Col[2] groups are equal. 按照不同类型分组的数据中，平均年龄这一列的每组的平均值是相等的。
<ul>
<li>groups也称 sub-populations</li>
</ul></li>
<li>备择假设 H1: Not all mean Average Age (Col[7])s of all Category (Col[2] groups are equal. 至少存在一个群类型i和群类型j，这两个类型分组的数据的平均年龄是不相等的，从而所有群类型的平均年龄的平均值并非全都相等。
<ul>
<li>注意这里并不会去说具体谁和谁不一样，需要post-hoc分析才知道。</li>
</ul></li>
</ul>
</section>
<section id="use-my-favorite-statistics-analysis-software." class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="use-my-favorite-statistics-analysis-software."><span class="header-section-number">4</span> 3. Use my favorite statistics analysis software.</h2>
<blockquote class="blockquote">
<p>Use your favorite statistics analysis software, like Matlab, R, Excel, SPSS or …</p>
</blockquote>
<p>这里我选择最喜欢的Python，灵活度最高，可编程性强，生态丰富，不过有人说里面的统计库有时候没有R的输出的专业。没关系啦。</p>
<p>注意到老师课堂上使用了Excel演示，我们有时间的话也稍微掌握一下。Excel的设计其实感觉很棒。</p>
<section id="a-draw-the-empirical-probability-density-function-and-test-normality" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="a-draw-the-empirical-probability-density-function-and-test-normality"><span class="header-section-number">4.1</span> 3.a Draw the empirical probability density function and Test normality</h3>
<blockquote class="blockquote">
<p>Draw the empirical probability density function of Col[7], i.e.&nbsp;the empirical pdf of average age. Does the data in this dimension follow Gaussian distribution? Test normality of Col[7].</p>
</blockquote>
<section id="文件读取" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="文件读取"><span class="header-section-number">4.1.1</span> 文件读取</h4>
<p>首先我们读取Excel文件到Python 的 pandas DataFrame</p>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> thu_big_data_ml.<span class="bu">help</span> <span class="im">import</span> lib_repo_path</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data_excel_path <span class="op">=</span> <span class="st">"data.xlsx"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data_excel_path <span class="op">=</span> lib_repo_path<span class="op">/</span><span class="st">"notebooks/coding_projects/P1_ANOVA"</span><span class="op">/</span>data_excel_path</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(data_excel_path, sheet_name<span class="op">=</span><span class="st">"data"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">群名</th>
<th data-quarto-table-cell-role="th">群类别</th>
<th data-quarto-table-cell-role="th">群人数</th>
<th data-quarto-table-cell-role="th">消息数</th>
<th data-quarto-table-cell-role="th">稠密度</th>
<th data-quarto-table-cell-role="th">性别比</th>
<th data-quarto-table-cell-role="th">平均年龄</th>
<th data-quarto-table-cell-role="th">年龄差</th>
<th data-quarto-table-cell-role="th">地域集中度</th>
<th data-quarto-table-cell-role="th">手机比例</th>
<th data-quarto-table-cell-role="th">会话数</th>
<th data-quarto-table-cell-role="th">无回应比例</th>
<th data-quarto-table-cell-role="th">夜聊比例</th>
<th data-quarto-table-cell-role="th">图片比例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>**手酒吧</td>
<td>1</td>
<td>63</td>
<td>315</td>
<td>0.051715</td>
<td>0.882353</td>
<td>26.681818</td>
<td>6.409413</td>
<td>0.222222</td>
<td>0.088889</td>
<td>23</td>
<td>0.434783</td>
<td>0.085714</td>
<td>0.069841</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>**秀嘉园</td>
<td>1</td>
<td>73</td>
<td>2</td>
<td>0.010274</td>
<td>0.579710</td>
<td>27.500000</td>
<td>9.042524</td>
<td>0.406780</td>
<td>0.000000</td>
<td>2</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>**ˇ⒊無黒\噵丶⒈群</td>
<td>1</td>
<td>73</td>
<td>4</td>
<td>0.024163</td>
<td>0.750000</td>
<td>23.415385</td>
<td>4.699893</td>
<td>0.287879</td>
<td>0.500000</td>
<td>4</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>**海网管工作联系基地</td>
<td>1</td>
<td>91</td>
<td>14</td>
<td>0.006105</td>
<td>0.901639</td>
<td>29.409091</td>
<td>2.854965</td>
<td>0.340426</td>
<td>0.142857</td>
<td>7</td>
<td>1.000000</td>
<td>0.250000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>tbsgame.net/bbs</td>
<td>1</td>
<td>133</td>
<td>2112</td>
<td>0.011107</td>
<td>0.961832</td>
<td>30.319672</td>
<td>4.669866</td>
<td>0.110236</td>
<td>0.167140</td>
<td>327</td>
<td>0.532110</td>
<td>0.104640</td>
<td>0.037879</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_category_info <span class="op">=</span> pd.read_excel(data_excel_path, sheet_name<span class="op">=</span><span class="st">"category_info"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_category_info.head()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">编号</th>
<th data-quarto-table-cell-role="th">主题</th>
<th data-quarto-table-cell-role="th">数量</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>游戏</td>
<td>484</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>同学会</td>
<td>300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>业主</td>
<td>196</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>投资理财</td>
<td>425</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>行业交流</td>
<td>635</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>因为是从0开始编号，所以题目说的第七列是</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.columns, df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>(Index(['群名', '群类别', '群人数', '消息数', '稠密度', '性别比', '平均年龄', '年龄差', '地域集中度', '手机比例',
        '会话数', '无回应比例', '夜聊比例', '图片比例'],
       dtype='object'),
 '平均年龄')</code></pre>
</div>
</div>
</section>
<section id="经验pdf绘制" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="经验pdf绘制"><span class="header-section-number">4.1.2</span> 经验pdf绘制</h4>
<p>现在我们可以绘制第七列（平均年龄）的经验概率密度函数图，这个图也叫做 直方图 histogram ，就是多个bin上面去经验地统计频数，从而来近似地描绘出数据分布的概率密度函数。</p>
<div id="cell-15" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置matplotlib支持中文显示</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 参考网上资料，说要设为 SimHei</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.rcParams['font.sans-serif'] = ['SimHei']  # 指定默认字体  </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span>  <span class="co"># 解决保存图像是负号'-'显示为方块的问题</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 但是SimHei这个linux上不存在，好像是微软的字体，不开源。</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 参考另一篇博客解决这个问题 https://blog.csdn.net/MAO_TOU/article/details/93998905</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> font_manager</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>font <span class="op">=</span> font_manager.FontProperties(fname<span class="op">=</span><span class="st">"/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [font.get_name()]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.hist(df['平均年龄'], bins=10, color='skyblue', edgecolor='black')  # 使用列名绘制直方图</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>df, x<span class="op">=</span>df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>] , kde<span class="op">=</span><span class="va">True</span>, kind<span class="op">=</span><span class="st">"hist"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'平均年龄的经验概率密度图'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'平均年龄'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'频数'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1000x600 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>上面的图不仅画了histogram，还画了kde曲线，kde是kernel density estimation的缩写，是一种非参数统计方法，用来估计概率密度函数。由于不是重点，这里不展开介绍，暂时只需要知道它和histogram类似都能反映分布，但是是连续曲线，所以可解释性较好。</p>
</section>
<section id="正态性检验" class="level4" data-number="4.1.3">
<h4 data-number="4.1.3" class="anchored" data-anchor-id="正态性检验"><span class="header-section-number">4.1.3</span> 正态性检验</h4>
<p>从图中来看，这一列的数据还是比较符合正态分布的。现在我们使用假设检验来验证这一点。 首先我们需要知道有哪些假设检验可以用来检验正态性，各自的优缺点有哪些？</p>
<p>我们找到两篇较为靠谱的论文 <a href="https://www.analystsoft.com/en/products/statplus/content/help/pdf/analysis_basic_statistics_normality_tests.pdf">Normality Tests</a> <a href="https://www.nrc.gov/docs/ML1714/ML17143A100.pdf">Power comparisons of Shapiro-Wilk, Kolmogorov-Smirnov, Lilliefors and Anderson-Darling tests</a>， 里面对各个检验都有介绍，结合其他网络资料，我整理了以下的思维导图：</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
    A[正态性检验] --&gt; B[Shapiro-Wilk 夏皮罗-威尔克 检验]
    A --&gt; C[Kolmogorov-Smirnov检验]
    A --&gt; D[Anderson-Darling 安德森-达令检验]
    A --&gt; E[D'Agostino-Pearson检验]
    A --&gt; Z[Lilliefors检验]

    B --&gt; F[零假设: 数据集来自于正态分布]
    B --&gt; G[使用条件: 小样本, 具体来说n&lt;50]
    B --&gt; H[优点: 灵敏度高, 被认为是小样本情况下最强大的检验, 计算效率高]
    B --&gt; I[缺点: 不适用于大样本, 过度敏感, 可能数据稍微偏离就误判不符合正态分布 ] 

    C --&gt; J[零假设: 样本来自的总体与指定的理论分布无显著差异]
    C --&gt; K[使用条件: 适用于连续分布, 大样本]
    C --&gt; L[优点: 无需分布假设, 可以两列样本直接比较, 不需要指定分布参数]
    C --&gt; M[缺点: 小样本上不够强大]

    D --&gt; N[零假设: 样本来自的总体与指定的理论分布无显著差异]
    D --&gt; O[使用条件: 适用于各种样本大小, 特别是当需要重视分布尾部差异时]
    D --&gt; P[优点: 更重视分布尾部, 某些情况下比KS强大]
    D --&gt; Q[缺点: 计算复杂, 每一个分布需要计算特定的临界值]

    E --&gt; R[零假设: 数据集来自于正态分布]
    E --&gt; S[使用条件: 大多数情况都可以]
    E --&gt; T[优点: 基于偏度和峰度系数]
    E --&gt; U[缺点: 结果容易受到异常值的影响]

    Z --&gt; V[零假设: 数据集来自于正态分布]
    Z --&gt; W[使用条件: 适用于小样本数据]
    Z --&gt; X[优点: 虽然是检验正态性, 但是不用假设是来自于哪一个正态分布, 就是均值方差不用指定, 因为是KS检验的改进版]
    Z --&gt; Y[缺点: 对于非独立同分布的数据不适用]

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>根据 https://www.lcgdbzz.org/custom/news/id/7951， 样本量大被认为是大于2000， 而根据https://blog.csdn.net/book_dw5189/article/details/133475648， 样本量&lt;50或者 &lt;200就认为小。 论文 https://www.amu.edu.my/wp-content/uploads/2024/01/V1_1_2023_Proceedings-of-Science-and-Management-2.pdf 中采用了 50 的说法。</p>
<p>我们的样本量是：</p>
<div id="cell-20" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>2040</code></pre>
</div>
</div>
<p>不管是上面的哪个说法，都应该认为是大样本量，所以我们应当采用 KS AD 和 DP 检验，而不应该采用SW和L检验。</p>
<div id="cell-22" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取第七列数据</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data_column = df.iloc[:, 7-1]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>data_column <span class="op">=</span> df[df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>]]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_column</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0       26.681818
1       27.500000
2       23.415385
3       29.409091
4       30.319672
          ...    
2035    28.330000
2036    27.928571
2037    25.723810
2038    27.085714
2039    27.223301
Name: 平均年龄, Length: 2040, dtype: float64</code></pre>
</div>
</div>
<p>首先是KS检验，刚才思维导图我们有个地方说的模糊，其实KS检验有两个，一个是单样本，一个是双样本，单样本就是直接和理论分布比，双样本是两列样本去比。 这里我的疑问是， - 两列样本的样本量可以不一样大吗？ - 答，不需要，双样本测试的时候，不要求两列样本的样本量相同。 - 单样本KS检验是不是通过把理论分布采样出来得到第二个样本列，然后调用双样本KS检验去实现的？还是说另有方法？ - 参考 https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test - KS检验的统计量是两个分布的最大差值，可以是经验分布或者理论分布。 - 如果是经验分布和理论分布去算KS值，是否要采样理论分布呢？ - 这个我暂时无法找到可信答案。</p>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 进行Kolmogorov-Smirnov检验</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ks_stat, ks_pvalue = stats.kstest(data_column, 'norm')</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 另一种写法</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> stats.ks_1samp(data_column, stats.norm.cdf, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> res.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Reject null hypothesis! Data is not normally distributed.'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reject null hypothesis! Data is not normally distributed.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>KstestResult(statistic=1.0, pvalue=0.0, statistic_location=13.097826087, statistic_sign=-1)</code></pre>
</div>
</div>
<p>看来KS检验告诉我们这个数据不是高斯分布呀，看来我们人眼看图还是有一定的主观性。 继续进行下一个检验试试。</p>
<div id="cell-28" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>stats.anderson(data_column, dist<span class="op">=</span><span class="st">'norm'</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>AndersonResult(statistic=9.382583309670736, critical_values=array([0.575, 0.655, 0.785, 0.916, 1.09 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=27.222012543150147, scale=4.986570293065674)
 success: True
 message: '`anderson` successfully fit the distribution to the data.')</code></pre>
</div>
</div>
<p>根据<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.anderson.html">文档</a> &gt; If the returned statistic is larger than these critical values then for the corresponding significance level, the null hypothesis that the data come from the chosen distribution can be rejected. 这里统计量9.38比 1.09都要大，所以显著度为100%的情况下都可以拒绝原假设，认为数据不来自于选定的分布。</p>
<p>接下来是 D’Agostino-Pearson检验</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 进行D'Agostino-Pearson检验</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> stats.normaltest(data_column)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> res.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Reject null hypothesis! Data is not normally distributed.'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reject null hypothesis! Data is not normally distributed.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>NormaltestResult(statistic=24.479341544296894, pvalue=4.8348001102946654e-06)</code></pre>
</div>
</div>
<p>根据<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.normaltest.html">文档</a> 正态分布因为是 zero skewness and zero (“excess” or “Fisher”) kurtosis，所以统计量应该很低， 但是我们得到的很大，所以p值特别小，所以拒绝原假设，认为数据不服从正态分布。</p>
<p>综合上面的检验，一致地得出结论，也就是col[7]并不服从正态分布。如果三个测试是独立的，那我们的type 1 error就特别低了，是1-0.05^3。不过第一个KS检验直接笃定地告诉我们是0了。</p>
<p>这里我又产生了一个疑问，假如我们三个假设检验都是在检验一个事情，但是得出的结论又不一样，我应该相信谁呢？我应该怎么集成不同的结果来进行决策呢？这让我联想到课上老师说的ANOVA对应的post-hoc test，有type-1 error inflation 的问题，使用了 Bonferroni correction 进行了调整。 所以我们三个检验也应该搞个holm方法，从小到大排序p值，然后alpha值从小到大检验，防止我们错误地以为不是正态分布？</p>
<p>除了假设检验外，还可以用过图示法来检验分布的正态性，比如Q-Q plot和P-P plot，由于不是重点，这里就不做过多介绍了。</p>
</section>
</section>
<section id="b-test-the-normality-of-each-components-and-test-the-homogeneity-of-variances" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="b-test-the-normality-of-each-components-and-test-the-homogeneity-of-variances"><span class="header-section-number">4.2</span> 3.b Test the normality of each components and test the homogeneity of variances</h3>
<blockquote class="blockquote">
<p>In Col[7], there are 5 components divided by category labels. We denote the data in Col[7] with category i (where i = 1,…,5) as Col[7|categoty=i]. Test the normality of each components and test the homogeneity of variances.</p>
</blockquote>
<p>我们首先画图直观感受一下分开之后的分布图</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>df, x<span class="op">=</span>df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>], hue<span class="op">=</span><span class="st">"群类别"</span>, kde<span class="op">=</span><span class="va">True</span>, kind<span class="op">=</span><span class="st">"hist"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"频数"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>Text(14.854888888888896, 0.5, '频数')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>从图中来看，数据看起来还是有点正态的，不过我们仍然需要假设检验。 而看起来方差并不是特别一致，特别是第5组图中能感觉方差明显小。</p>
<section id="正态性检验-1" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="正态性检验-1"><span class="header-section-number">4.2.1</span> 正态性检验</h4>
<p>我们使用 for 循环来对每个变量进行多种正态性检验方法。</p>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>interesting_col <span class="op">=</span> df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>grouped_data <span class="op">=</span> df.groupby(<span class="st">'群类别'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># grouped_data</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>normality_results <span class="op">=</span> {}</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, group <span class="kw">in</span> grouped_data:</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    normality_result <span class="op">=</span> {}</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    data_column <span class="op">=</span> group[interesting_col]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> stats.ks_1samp(data_column, stats.norm.cdf, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    normality_result[<span class="st">'Kolmogorov-Smirnov'</span>] <span class="op">=</span> <span class="st">"Not Normal"</span> <span class="cf">if</span> res.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">"Normal"</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> stats.anderson(data_column, dist<span class="op">=</span><span class="st">'norm'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    critical_value <span class="op">=</span> res.critical_values[<span class="dv">2</span>] <span class="co"># 0.05 level</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    normality_result[<span class="st">'Anderson-Darling'</span>] <span class="op">=</span> <span class="st">"Not Normal"</span> <span class="cf">if</span> res.statistic <span class="op">&gt;</span> critical_value <span class="cf">else</span> <span class="st">"Normal"</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> stats.normaltest(data_column)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    normality_result[<span class="st">"D'Agostino-Pearson"</span>] <span class="op">=</span> <span class="st">"Not Normal"</span> <span class="cf">if</span> res.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">"Normal"</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    normality_results[name] <span class="op">=</span> normality_result</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(normality_results)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kolmogorov-Smirnov</td>
<td>Not Normal</td>
<td>Not Normal</td>
<td>Not Normal</td>
<td>Not Normal</td>
<td>Not Normal</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anderson-Darling</td>
<td>Not Normal</td>
<td>Not Normal</td>
<td>Normal</td>
<td>Not Normal</td>
<td>Not Normal</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D'Agostino-Pearson</td>
<td>Not Normal</td>
<td>Normal</td>
<td>Normal</td>
<td>Not Normal</td>
<td>Not Normal</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>由此可见，Col[7|categoty=2] 和 Col[7|categoty=3] 有可能是正态的，而另外三组都不太符合正态分布。</p>
</section>
<section id="方差齐性检验" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="方差齐性检验"><span class="header-section-number">4.2.2</span> 方差齐性检验</h4>
<p>我们首先使用 Rule of thumb 经验法则来看看数据是否满足方差齐性。</p>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>std_devs <span class="op">=</span> grouped_data[interesting_col].std()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ratio_largest_to_smallest <span class="op">=</span> std_devs.<span class="bu">max</span>() <span class="op">/</span> std_devs.<span class="bu">min</span>() </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>variance_homogeneity <span class="op">=</span> ratio_largest_to_smallest<span class="op">&lt;=</span> <span class="dv">2</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>std_devs, ratio_largest_to_smallest, variance_homogeneity</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>(群类别
 1    4.923757
 2    5.217371
 3    2.552901
 4    5.098256
 5    3.018979
 Name: 平均年龄, dtype: float64,
 2.0437025537615634,
 False)</code></pre>
</div>
</div>
<p>哎呀看来差一点点，2.04刚好比2大一些，所以拇指法则认为我们做不了ANOVA啦。</p>
<p>下面我们再探索下假设检验来验证方差齐性，这样更严谨一些。</p>
<div id="cell-45" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>group_values_list <span class="op">=</span> [grouped_data[interesting_col].get_group(x).values <span class="cf">for</span> x <span class="kw">in</span> grouped_data.groups]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>group_values_list[<span class="dv">0</span>][:<span class="dv">5</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>array([26.68181818, 27.5       , 23.41538462, 29.40909091, 30.31967213])</code></pre>
</div>
</div>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 进行Bartlett的方差齐性检验</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>bartlett_result <span class="op">=</span> stats.bartlett(<span class="op">*</span>group_values_list)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> bartlett_result.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reject the null hypothesis of equal variances! "</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>bartlett_result</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reject the null hypothesis of equal variances! </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>BartlettResult(statistic=276.31560984738496, pvalue=1.387826766589022e-58)</code></pre>
</div>
</div>
<p>可以明显看到pvalue特别低，所以很明显不同组的方差不一样，和拇指法则的结果是一致的。</p>
</section>
</section>
<section id="c-do-the-one-way-anova-test-for-col7-with-categories-in-col2." class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="c-do-the-one-way-anova-test-for-col7-with-categories-in-col2."><span class="header-section-number">4.3</span> 3.c Do the one-way ANOVA test for Col[7] with categories in Col[2].</h3>
<blockquote class="blockquote">
<p>Do the one-way ANOVA test for Col[7] with categories in Col[2]. Write down your conclusion, supporting statistics, and visualize your data which inspire the process.</p>
</blockquote>
<p>我们首先可以画一个箱线图，直观感受一下数据的分布差异</p>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制分组分布图</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'群类别'</span>, y<span class="op">=</span>df.columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>], data<span class="op">=</span>df)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'群类别与平均年龄的分布图'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'群类别'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'平均年龄'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>可以感觉到他们的平均值还是有点差距的，现在我们尝试做ANOVA。 不过刚才3.b 我们发现ANOVA的假设并不成立，所以我们得分析结果未必准确。</p>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> f_oneway <span class="co"># ANOVA 又称 F检验，所以scipy命名为f_oneway</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> f_oneway(<span class="op">*</span>group_values_list)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> res.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reject null hypothesis! There is a significant difference in the means between the groups."</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reject null hypothesis! There is a significant difference in the means between the groups.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>F_onewayResult(statistic=171.50703270711966, pvalue=1.0820916064752822e-126)</code></pre>
</div>
</div>
<p>这里我们已经得到了结果，根据<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.f_oneway.html">文档</a>，scipy的statistic就是我们课上学习的F统计量，也就是 <span class="math inline">\(F = \frac{between}{within}\)</span>，这就是我们的<strong>Supporting statistic</strong>。其中记得between和within不只是方差，还要除以自由度的。</p>
<p>我们的<strong>Conclusion</strong>就是不同群类别的平均年龄具有显著差异。</p>
<p>我们课上学习的时候，ANOVA能得到一个较为详细的表格，包括 SS, df, MS, 不只是上面scipy输出的F和p。所以我们决定使用更加专业的统计库 statsmodels 再来进行一次 ANOVA，参考<a href="https://www.statsmodels.org/stable/anova.html">文档</a>。</p>
<div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ols(<span class="ss">f'</span><span class="sc">{</span>df<span class="sc">.</span>columns[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> ~ C(</span><span class="sc">{</span>df<span class="sc">.</span>columns[<span class="dv">7</span><span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)'</span>, data<span class="op">=</span>df).fit()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model.f_pvalue</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>0.2481580545669197</code></pre>
</div>
</div>
<p>首先ols是个缩写，全称是 ordinary least squares (OLS), 与之对应的方法是 weighted least squares (WLS), generalized least squares (GLS)。</p>
<p>其中 C(x) 是 <a href="https://segmentfault.com/q/1010000012066946">R formula style 语法</a>。 具体来说， - ~：这是一个分隔符，用于区分因变量（响应变量）和自变量（解释变量或预测变量）。 - C(x)函数用于指定x变量应该被视为categorical variable。在R中，分类变量通常用于表示名义尺度或序数尺度的变量，比如性别、种族、国家等。 - 那么具体来说R语言是怎么处理C(x)的呢？在Python sklearn里面我们经常会用one hot编码，R也是使用one hot编码吗？ - 实际上，R语言单独有因子(Factor)类型，不是先处理为one hot再输入ols，而是直接输入ols让ols决定具体怎么处理。 - “Y ~ X1+X2” + 表示 X1 和 X2 都是自变量。 - 可以参考 http://www.sthda.com/english/articles/40-regression-analysis/163-regression-with-categorical-variables-dummy-coding-essentials-in-r/</p>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>anova_table <span class="op">=</span> sm.stats.anova_lm(model, test<span class="op">=</span><span class="st">'F'</span>, typ<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>anova_table</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sum_sq</th>
<th data-quarto-table-cell-role="th">df</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">PR(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">C(平均年龄)</td>
<td>4844.373039</td>
<td>1922.0</td>
<td>1.103449</td>
<td>0.248158</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Residual</td>
<td>267.250000</td>
<td>117.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>为什么使用statsmodels库的时候我们用到了线性回归呢？ 参考<a href="https://bookdown.org/hetongqi0320/qht_R4psyBook/%E7%AC%AC%E5%85%AB%E8%AE%B2%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B%E4%B8%80.html#anova-linear-regression">这本书第九讲</a>的内容，我们了解到，ANOVA本质上检验线性回归模型的参数是否为零。这篇<a href="https://zhuanlan.zhihu.com/p/64553954?utm_id=0">科普文章</a>也可以参考一下。</p>
<p>刚才调用的两个库其实都和我们课上学习的有点不一样，为了加深我们的理解，我们<strong>自己实现一下</strong>ANOVA。 根据课件上的顺序，我们逐一计算 - grand mean - between-group variation - within-group variation</p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L12" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="anova_oneway" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="anova_oneway"><span class="header-section-number">4.4</span> anova_oneway</h3>
<blockquote class="blockquote">
<pre><code> anova_oneway (*groups:numpy.ndarray)</code></pre>
</blockquote>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>groups</td>
<td>ndarray</td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>DataFrame</strong></td>
<td><strong>返回ANOVA表格。包括我们课堂上学习的内容。</strong></td>
</tr>
</tbody>
</table>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> anova_oneway(<span class="op">*</span>group_values_list)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其中我们F为什么叫做F呢？ - 其实是因为 F Value obeys Fisher Distribution， 这个分布是 Fisher大神提出的（ANOVA也是Fisher提出的），Fisher把自己的F命名进去。</p>
<p>那p为什么叫做p呢？ - p 是 probabilty的缩写，表示事件发生的概率，什么事情呢？ - 如果null hypothesis是正确的，数据出现这件事情的概率。 - 所以p也是如果拒绝 null hypothesis，我们会犯错误的概率，也就是 Type I Error。</p>
<p>我们再试一下excel表格的ANOVA，看看和我们刚才编写的代码结果一不一样。</p>
<p>首先默认来说Excel没有开启分析功能。需要 “文件”-&gt;“选项”-&gt;“加载项”，在“管理”下拉菜单中选择“Excel加载项”，然后勾选“分析工具库”和“分析工具库 - VBA”来完成加载。</p>
<p>第二，Excel的ANOVA对输入格式有要求，必须是分组之后矩阵的形式，我们原本的数据就是两列，所以不对，需要先把数据整理成分组之后的矩阵形式。 - 然而，在尝试了数据透视表、excel公式等方式之后，我放弃了，excel分个组太麻烦了。 - 我觉得直接python导出数据到excel，然后用excel的分析功能来做ANOVA。</p>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>group_values_df <span class="op">=</span> pd.DataFrame(group_values_list)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>group_values_df.to_excel(<span class="st">"group_values.xlsx"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>group_values_df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">625</th>
<th data-quarto-table-cell-role="th">626</th>
<th data-quarto-table-cell-role="th">627</th>
<th data-quarto-table-cell-role="th">628</th>
<th data-quarto-table-cell-role="th">629</th>
<th data-quarto-table-cell-role="th">630</th>
<th data-quarto-table-cell-role="th">631</th>
<th data-quarto-table-cell-role="th">632</th>
<th data-quarto-table-cell-role="th">633</th>
<th data-quarto-table-cell-role="th">634</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>26.681818</td>
<td>27.500000</td>
<td>23.415385</td>
<td>29.409091</td>
<td>30.319672</td>
<td>26.112500</td>
<td>29.738095</td>
<td>26.313433</td>
<td>24.415094</td>
<td>23.933333</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>37.109375</td>
<td>27.147059</td>
<td>28.631579</td>
<td>20.212121</td>
<td>26.171717</td>
<td>17.106383</td>
<td>30.333333</td>
<td>38.266667</td>
<td>26.494118</td>
<td>31.022222</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>27.500000</td>
<td>30.083551</td>
<td>32.457746</td>
<td>35.086420</td>
<td>31.474576</td>
<td>28.626866</td>
<td>30.650206</td>
<td>34.169811</td>
<td>30.225000</td>
<td>33.113924</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>24.254545</td>
<td>26.245283</td>
<td>30.533333</td>
<td>26.333333</td>
<td>23.964286</td>
<td>27.645833</td>
<td>27.718750</td>
<td>33.693878</td>
<td>28.571429</td>
<td>20.219178</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>31.019355</td>
<td>28.986667</td>
<td>29.116279</td>
<td>29.401430</td>
<td>27.616216</td>
<td>32.521053</td>
<td>32.454545</td>
<td>26.257143</td>
<td>28.516129</td>
<td>31.014634</td>
<td>...</td>
<td>27.377049</td>
<td>27.112</td>
<td>26.623632</td>
<td>25.816667</td>
<td>25.668712</td>
<td>28.33</td>
<td>27.928571</td>
<td>25.72381</td>
<td>27.085714</td>
<td>27.223301</td>
</tr>
</tbody>
</table>

<p>5 rows × 635 columns</p>
</div>
</div>
</div>
<p>在弹出的“数据分析”对话框中，选择“方差分析：单一因子（ANOVA：Single Factor）”，然后点击“确定”。 <img src="anova_files/figure-html/cell-67-2-image.png" class="img-fluid" alt="image.png"></p>
<p>结果如下</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="anova_files/figure-html/cell-67-1-image-2.png" class="img-fluid figure-img"></p>
<figcaption>image-2.png</figcaption>
</figure>
</div>
<p>我们看到excel计算的结果和我们自己计算的结果一致，除了 p value不同。</p>
<p>我们的pvalue 是按照课件上的图来的，就是 X~F(df_between, df_within)下 P(X&gt;f_value)，仔细检查还是没发现问题。</p>
<p>但是确实 excel计算的结果又和 scipy的一样，说明是我们错了而不是他们错了。</p>
<p>所以我们课件上的计算方法其实后来有改进版本，能得到更加准确的pvalue。</p>
<p>经过检查，原来excel和scipy采用的p value 是 P(X=f_value), 直接使用了密度函数那个位置的值。</p>
<p>根据<a href="https://www.quora.com/What-is-the-meaning-of-Pr-F-in-Anova-Is-it-a-P-value">网上问答</a> 这两个方法算p value都是OK的。</p>
<p>另一个问题是，OLS得到的pvalue和excel、scipy以及我们的结论不一致，OLS似乎认为变化不显著！</p>
</section>
</section>
<section id="find-another-three-columns-and-test-whether-they-follow-the-anova-assumptions." class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="find-another-three-columns-and-test-whether-they-follow-the-anova-assumptions."><span class="header-section-number">5</span> 4. Find another three columns and test whether they follow the ANOVA assumptions.</h2>
<blockquote class="blockquote">
<p>Choose another 3 columns, draw the empirical pdf of each feature columns and test which column follows these assumptions in question 1? How about their corresponding log transformation?</p>
</blockquote>
<p>首先我们需要连续型随机变量，我们看看那些是</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>continuous_vars <span class="op">=</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'float'</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>continuous_vars.describe()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">稠密度</th>
<th data-quarto-table-cell-role="th">性别比</th>
<th data-quarto-table-cell-role="th">平均年龄</th>
<th data-quarto-table-cell-role="th">年龄差</th>
<th data-quarto-table-cell-role="th">地域集中度</th>
<th data-quarto-table-cell-role="th">手机比例</th>
<th data-quarto-table-cell-role="th">无回应比例</th>
<th data-quarto-table-cell-role="th">夜聊比例</th>
<th data-quarto-table-cell-role="th">图片比例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
<td>2040.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.075238</td>
<td>0.653186</td>
<td>27.222013</td>
<td>5.274628</td>
<td>0.552023</td>
<td>0.261570</td>
<td>0.705734</td>
<td>0.145622</td>
<td>0.032474</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.114423</td>
<td>0.191333</td>
<td>4.986570</td>
<td>2.407647</td>
<td>0.294685</td>
<td>0.277207</td>
<td>0.236187</td>
<td>0.186805</td>
<td>0.080868</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000303</td>
<td>0.000000</td>
<td>13.097826</td>
<td>0.335623</td>
<td>0.076543</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.010693</td>
<td>0.542373</td>
<td>24.035470</td>
<td>3.774116</td>
<td>0.250000</td>
<td>0.019967</td>
<td>0.523719</td>
<td>0.011480</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.024804</td>
<td>0.667256</td>
<td>27.880909</td>
<td>5.356491</td>
<td>0.576114</td>
<td>0.166667</td>
<td>0.718730</td>
<td>0.087869</td>
<td>0.006719</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.076384</td>
<td>0.798379</td>
<td>30.436108</td>
<td>6.727624</td>
<td>0.836538</td>
<td>0.428571</td>
<td>0.921559</td>
<td>0.200000</td>
<td>0.030185</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.609764</td>
<td>1.000000</td>
<td>44.243902</td>
<td>13.841550</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>注意 群人数 消息数 会话数 这几个变量是整数，但是不是类别型随机变量，大小是有意义的，不过我们暂时不考虑它们，也是忽略掉。</p>
<p>现在我们随机选择三个</p>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-72" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random.seed(5)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">0</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>chosen_cols <span class="op">=</span> random.choices(continuous_vars.columns, k<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>chosen_cols</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="171">
<pre><code>['夜聊比例', '无回应比例', '年龄差']</code></pre>
</div>
</div>
<section id="经验分布" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="经验分布"><span class="header-section-number">5.1</span> 经验分布</h3>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L90" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="draw_hist" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="draw_hist"><span class="header-section-number">5.2</span> draw_hist</h3>
<blockquote class="blockquote">
<pre><code> draw_hist (df, chosen_cols, hue_col='群类别', transform=None,
            column_name_transform=None)</code></pre>
</blockquote>
<div id="cell-75" class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>draw_hist(df, chosen_cols, hue_col<span class="op">=</span><span class="st">'群类别'</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-35-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="正态性检验-2" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="正态性检验-2"><span class="header-section-number">5.3</span> 正态性检验</h3>
<p>我们使用 for 循环来对每个变量进行多种正态性检验方法。 注意ANOVA的正态性是说分组的正态性。 如果每一组都是正态分布，而且零假设不成立，那合在一起其实是Gaussian Mixture Model。</p>
<p>下面的代码我们引入log=False 参数，决定是对原始数据还是对log数据进行正态性检验。</p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L115" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="test_normality_group" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="test_normality_group"><span class="header-section-number">5.4</span> test_normality_group</h3>
<blockquote class="blockquote">
<pre><code> test_normality_group (df, interesting_col, hue_col='群类别', transform=None)</code></pre>
</blockquote>
<div id="cell-78" class="cell" data-execution_count="195">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(chosen_cols):</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Testing normality for column </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(test_normality_group(df, col))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing normality for column 夜聊比例
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Testing normality for column 无回应比例
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Testing normality for column 年龄差
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal      Normal  Not Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal      Normal  Not Normal  Not Normal  Not Normal</code></pre>
</div>
</div>
<p>可以看到除了 年龄差的第二组以外，其他的数据根本不满足正态分布。</p>
<p>我们再尝试一下log后的正态性检验。</p>
<div id="cell-80" class="cell" data-execution_count="215">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>log_transform <span class="op">=</span> <span class="kw">lambda</span> data_column: np.log(data_column<span class="op">+</span>np.<span class="bu">min</span>(data_column)<span class="op">+</span><span class="dv">1</span>)  <span class="co"># 保证 大于0 </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># np.log(data_column) </span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>log_transform([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>])</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="215">
<pre><code>array([1.09861229, 1.38629436, 1.60943791, 1.79175947, 1.94591015])</code></pre>
</div>
</div>
<div id="cell-81" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(chosen_cols):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Testing normality for column log(</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(test_normality_group(df, col, transform<span class="op">=</span>log_transform))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing normality for column log(夜聊比例)
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Testing normality for column log(无回应比例)
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Testing normality for column log(年龄差)
                             1           2           3           4           5
Kolmogorov-Smirnov  Not Normal  Not Normal  Not Normal  Not Normal  Not Normal
Anderson-Darling    Not Normal  Not Normal      Normal  Not Normal  Not Normal
D'Agostino-Pearson  Not Normal  Not Normal      Normal  Not Normal  Not Normal</code></pre>
</div>
</div>
<p>看来并没有什么特别效果，还是不正态的多，年龄差的第二组反而变得不正态了，第三组正态了。</p>
<section id="方差齐性检验-1" class="level4" data-number="5.4.1">
<h4 data-number="5.4.1" class="anchored" data-anchor-id="方差齐性检验-1"><span class="header-section-number">5.4.1</span> 方差齐性检验</h4>
<p>我们首先使用 Rule of thumb 经验法则 和 bartlett 检验一起来看</p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L139" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="homogeneity_of_variance" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="homogeneity_of_variance"><span class="header-section-number">5.5</span> homogeneity_of_variance</h3>
<blockquote class="blockquote">
<pre><code> homogeneity_of_variance (df, interesting_col, hue_col='群类别',
                          transform=None)</code></pre>
</blockquote>
<div id="cell-85" class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, chosen_col <span class="kw">in</span> <span class="bu">enumerate</span>(chosen_cols):</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Now testing variance_homogeneity of column: </span><span class="sc">{</span>chosen_col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(homogeneity_of_variance(df, chosen_col, transform<span class="op">=</span><span class="va">None</span>))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Now testing variance_homogeneity of column: 夜聊比例
The variances may be homogeneous, according to rule of thumb.
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 1.7654023254103777, 'bartlett_result': BartlettResult(statistic=184.4526258346371, pvalue=8.244412669557808e-39)}

Now testing variance_homogeneity of column: 无回应比例
The variances may be homogeneous, according to rule of thumb.
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 1.2996307493612391, 'bartlett_result': BartlettResult(statistic=44.64819549378769, pvalue=4.705138240554607e-09)}

Now testing variance_homogeneity of column: 年龄差
The variances may be homogeneous, according to rule of thumb.
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 1.5888982653697075, 'bartlett_result': BartlettResult(statistic=155.50950582298964, pvalue=1.342198169091211e-32)}
</code></pre>
</div>
</div>
<div id="cell-86" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, chosen_col <span class="kw">in</span> <span class="bu">enumerate</span>(chosen_cols):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Now testing variance_homogeneity of column: log(</span><span class="sc">{</span>chosen_col<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(homogeneity_of_variance(df, chosen_col, transform<span class="op">=</span>log_transform))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Now testing variance_homogeneity of column: log(夜聊比例)
The variances may be homogeneous, according to rule of thumb.
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 1.6365600965654272, 'bartlett_result': BartlettResult(statistic=139.12782583219428, pvalue=4.338695149250475e-29)}

Now testing variance_homogeneity of column: log(无回应比例)
The variances may be homogeneous, according to rule of thumb.
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 1.3586915605576353, 'bartlett_result': BartlettResult(statistic=61.67293119869295, pvalue=1.2906782641394537e-12)}

Now testing variance_homogeneity of column: log(年龄差)
The variances are not homogeneous!
Reject the null hypothesis of equal variances! 
{'ratio_largest_to_smallest': 2.282065192732663, 'bartlett_result': BartlettResult(statistic=386.6067271555664, pvalue=2.17718926130104e-82)}
</code></pre>
</div>
</div>
<p>进行log之后反而年龄差连拇指法则都认为不满足方差齐性了，太可怕了。看来log变换对这三列数据不太有效果。</p>
</section>
</section>
<section id="how-to-do-one-way-anova-with-the-non-normal-data" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="how-to-do-one-way-anova-with-the-non-normal-data"><span class="header-section-number">6</span> 5. How to do one-way ANOVA with the non-normal data?</h2>
<section id="a-find-and-list-the-possible-solutions-set." class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="a-find-and-list-the-possible-solutions-set."><span class="header-section-number">6.1</span> 5.a Find and list the possible solutions set.</h3>
<p>经过查找网络资料，我们采纳<a href="https://ri.conicet.gov.ar/bitstream/handle/11336/31210/CONICET_Digital_Nro.dd9c5c0f-c69e-4018-9d9c-cb111fec6c77_A.pdf;jsessionid=E7832F681CB808FDC759C8152D13EE89?sequence=2">论文4.2.1节</a>的总结方式，当数据不满足服从正态分布时，有三类解决思路，数据转换、非参数检验和广义线性模型。</p>
<ol type="1">
<li>通过数据转换，把原本数据转换为服从正态分布的数据，比如log变换、Box-Cox变换等，然后我们对转换后的数据进行ANOVA分析。</li>
</ol>
<ul>
<li>有哪些变换？log变换、Box-Cox变换、平方根转换和反正弦平方根转换等。</li>
<li>缺点：<a href="https://ri.conicet.gov.ar/bitstream/handle/11336/31210/CONICET_Digital_Nro.dd9c5c0f-c69e-4018-9d9c-cb111fec6c77_A.pdf;jsessionid=E7832F681CB808FDC759C8152D13EE89?sequence=2">论文4.2.2节</a>指出，转换可能会改变原始数据的解释，且需要谨慎选择合适的转换方法以确保分析结果的准确性。</li>
</ul>
<ol start="2" type="1">
<li>换一个不需要假设正态分布的、功能类似的检验方法（一般是非参数检验方法），比如Kruskal-Wallis检验。</li>
</ol>
<ul>
<li>优点：
<ul>
<li>非参数检验不需要数据服从正态分布，因此在数据不满足正态性假设时仍能提供有效的结果。</li>
<li>这个不局限于正态假设不满足，其他ANOVA假设不满足也可以用。比如<a href="https://onlinepubs.trb.org/onlinepubs/nchrp/cd-22/manual/v2chapter4.pdf">文章</a>指出，如果方差齐性假设不满足，要用Kruskal-Wallis检验。</li>
<li><a href="https://www.jmlr.org/papers/volume7/demsar06a/demsar06a.pdf">机器学习经典的一篇万引论文</a>指出，多个数据集上对比不同的机器学习方法不应当使用ANOVA，因为正态性假设和方差齐性假设不一定成立，所以应当使用Friedman检验。</li>
</ul></li>
<li>缺点：非参数检验通常比参数检验具有较低的统计功效，这意味着在相同条件下更容易犯第二类错误（即未能拒绝错误的零假设）</li>
</ul>
<ol start="3" type="1">
<li>上文我们提到，ANOVA和线性回归的参数非零检验是有等价的，而线性回归的误差项被假设为是正态分布，所以才导致ANOVA需要假设正态分布，所以我们可以使用广义线性模型（误差项可以服从泊松分布、二项分布等），然后进行分析。</li>
</ol>
<ul>
<li>可以参考<a href="https://bookdown.org/hetongqi0320/qht_R4psyBook/%E7%AC%AC%E5%8D%81%E8%AE%B2%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B%E4%B8%89%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B.html">这本书第十讲</a></li>
</ul>
</section>
<section id="b-do-the-one-way-anova-on-the-3-columns-you-choose.-do-these-feature-columns-vary-significantly-visualize-the-results." class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="b-do-the-one-way-anova-on-the-3-columns-you-choose.-do-these-feature-columns-vary-significantly-visualize-the-results."><span class="header-section-number">6.2</span> 5.b Do the one-way ANOVA on the 3 columns you choose. Do these feature columns vary significantly? Visualize the results.</h3>
<p>刚才在 4. 中我们发现，简单使用log变换仍然无法让数据满足正态分布，甚至会破坏方差齐性！我们得尝试使用 5.a中的办法来改进一下！</p>
<section id="直接进行-anova-分析" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="直接进行-anova-分析"><span class="header-section-number">6.2.1</span> 直接进行 ANOVA 分析</h4>
<p>刚才我们注意到，log变换之前其实数据已经满足拇指法则的要求，方差齐性问题不大；而正态性假设不满足我们勉强接受，开始直接进行 ANOVA 分析。</p>
<p>调用我们刚才自己编写的 <a href="https://Open-Book-Studio.github.io/THU-Coursework-Machine-Learning-for-Big-Data/coding_projects/P1_ANOVA/anova.html#anova_oneway"><code>anova_oneway</code></a> 函数，这里我们实现 <a href="https://Open-Book-Studio.github.io/THU-Coursework-Machine-Learning-for-Big-Data/coding_projects/P1_ANOVA/anova.html#auto_anova_for_df"><code>auto_anova_for_df</code></a> 提高API的易用性。</p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L169" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="auto_anova_for_df" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="auto_anova_for_df"><span class="header-section-number">6.3</span> auto_anova_for_df</h3>
<blockquote class="blockquote">
<pre><code> auto_anova_for_df (df, interesting_col, hue_col='群类别', transform=None)</code></pre>
</blockquote>
<div id="cell-92" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>res_dfs <span class="op">=</span> []</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chosen_col <span class="kw">in</span> chosen_cols:</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Doing ANOVA for {chosen_col}")</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print()</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> auto_anova_for_df(df, chosen_col)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    res_dfs.append(res)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># index = pd.MultiIndex.from_tuples([(x, y) for x in chosen_cols for y in ["Between", "Within", "Total"]],</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                             names=['Category', 'Source'])</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># df_combined = pd.DataFrame(index=index, columns=res_dfs[0].columns)</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, source in enumerate(chosen_cols):</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     # for s in ['Between', 'Within', 'Total']:</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     #         df_combined.loc[(source, s)] = res_dfs[i].loc[res_dfs[i]['Source'] == s, :]</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     df_combined.iloc[i] = res_dfs[i].values</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># df_combined</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(chosen_cols[<span class="dv">0</span>])</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>res_dfs[<span class="dv">0</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>夜聊比例</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="237">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">Sum of Squares (SS)</th>
<th data-quarto-table-cell-role="th">Degrees of Freedom (df)</th>
<th data-quarto-table-cell-role="th">Mean Square (MS)</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p</th>
<th data-quarto-table-cell-role="th">p_excel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Between</td>
<td>3.721528</td>
<td>4</td>
<td>0.930382</td>
<td>28.077748</td>
<td>1.110223e-16</td>
<td>1.842338e-22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Within</td>
<td>67.431602</td>
<td>2035</td>
<td>0.033136</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Total</td>
<td>71.153130</td>
<td>2039</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-93" class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(chosen_cols[<span class="dv">1</span>])</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>res_dfs[<span class="dv">1</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>无回应比例</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="238">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">Sum of Squares (SS)</th>
<th data-quarto-table-cell-role="th">Degrees of Freedom (df)</th>
<th data-quarto-table-cell-role="th">Mean Square (MS)</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p</th>
<th data-quarto-table-cell-role="th">p_excel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Between</td>
<td>6.689130</td>
<td>4</td>
<td>1.672283</td>
<td>31.788299</td>
<td>1.110223e-16</td>
<td>1.859627e-25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Within</td>
<td>107.054963</td>
<td>2035</td>
<td>0.052607</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Total</td>
<td>113.744093</td>
<td>2039</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-94" class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(chosen_cols[<span class="dv">2</span>])</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>res_dfs[<span class="dv">2</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>年龄差</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="239">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">Sum of Squares (SS)</th>
<th data-quarto-table-cell-role="th">Degrees of Freedom (df)</th>
<th data-quarto-table-cell-role="th">Mean Square (MS)</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p</th>
<th data-quarto-table-cell-role="th">p_excel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Between</td>
<td>3338.236332</td>
<td>4</td>
<td>834.559083</td>
<td>200.242216</td>
<td>1.110223e-16</td>
<td>9.043259e-145</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Within</td>
<td>8481.367055</td>
<td>2035</td>
<td>4.167748</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Total</td>
<td>11819.603387</td>
<td>2039</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>看来这三个特征还是很明显会被群类别影响的！p值非常小！ 接下来可视化！</p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L182" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="draw_box" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="draw_box"><span class="header-section-number">6.4</span> draw_box</h3>
<blockquote class="blockquote">
<pre><code> draw_box (df, chosen_cols, hue_col='群类别', transform=None,
           column_name_transform=None)</code></pre>
</blockquote>
<div id="cell-97" class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>draw_box(df, chosen_cols)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="anova_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="应用解决办法2采用不对数据要求那么严格的假设检验方法" class="level4" data-number="6.4.1">
<h4 data-number="6.4.1" class="anchored" data-anchor-id="应用解决办法2采用不对数据要求那么严格的假设检验方法"><span class="header-section-number">6.4.1</span> 应用解决办法2——采用不对数据要求那么严格的假设检验方法</h4>
<section id="friedman检验" class="level5" data-number="6.4.1.1">
<h5 data-number="6.4.1.1" class="anchored" data-anchor-id="friedman检验"><span class="header-section-number">6.4.1.1</span> Friedman检验</h5>
<p><a href="https://www.jmlr.org/papers/volume7/demsar06a/demsar06a.pdf">机器学习经典的一篇万引论文</a>指出，多个数据集上对比不同的机器学习方法不应当使用ANOVA，因为正态性假设和方差齐性假设不一定成立，所以应当使用Friedman检验。</p>
<p>这里我们采用Friedman检验尝试一下，看看是否如这篇论文说的那么适合。</p>
<p>使用 scipy实现的 <code>friedmanchisquare</code></p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L194" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
</section>
<section id="auto_friedman_for_df" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="auto_friedman_for_df"><span class="header-section-number">6.5</span> auto_friedman_for_df</h3>
<blockquote class="blockquote">
<pre><code> auto_friedman_for_df (df, interesting_col, hue_col='群类别', transform=None)</code></pre>
</blockquote>
<div id="cell-100" class="cell" data-execution_count="261">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>res_dfs <span class="op">=</span> []</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chosen_col <span class="kw">in</span> chosen_cols:</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f"Doing ANOVA for {chosen_col}")</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print()</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> auto_friedman_for_df(df, chosen_col)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>        res_dfs.append(res)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Friedman for col </span><span class="sc">{</span>chosen_cols[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error: Unequal N in friedmanchisquare.  Aborting.</code></pre>
</div>
</div>
<p>实践出真知，原来 Friedman 测试要求每个treatment有相同的数据量！这确实适合对比机器学习方法，因为这些方法都在N个数据集上做了实验，但是确实不适合我们这里的数据。</p>
<section id="kruskal-wallis" class="level5" data-number="6.5.0.1">
<h5 data-number="6.5.0.1" class="anchored" data-anchor-id="kruskal-wallis"><span class="header-section-number">6.5.0.1</span> Kruskal-Wallis</h5>
<p>再来尝试一下 <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kruskal.html">这个</a></p>
<hr>
<p><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/blob/main/thu_big_data_ml/big_data_analytics/anova.py#L210" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="auto_kruskal_for_df" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="auto_kruskal_for_df"><span class="header-section-number">6.6</span> auto_kruskal_for_df</h3>
<blockquote class="blockquote">
<pre><code> auto_kruskal_for_df (df, interesting_col, hue_col='群类别', transform=None)</code></pre>
</blockquote>
<div id="cell-103" class="cell" data-execution_count="266">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>res_dfs <span class="op">=</span> []</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chosen_col <span class="kw">in</span> chosen_cols:</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Doing ANOVA for {chosen_col}")</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print()</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> auto_kruskal_for_df(df, chosen_col)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    res_dfs.append(res)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kruskal-Wallis for col </span><span class="sc">{</span>chosen_cols[k]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>res_dfs[k]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kruskal-Wallis for col 夜聊比例</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="266">
<pre><code>KruskalResult(statistic=113.85430517053221, pvalue=1.0958066785877727e-23)</code></pre>
</div>
</div>
<div id="cell-104" class="cell" data-execution_count="267">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kruskal-Wallis for col </span><span class="sc">{</span>chosen_cols[k]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>res_dfs[k]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kruskal-Wallis for col 无回应比例</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="267">
<pre><code>KruskalResult(statistic=110.47802046935365, pvalue=5.754933877750579e-23)</code></pre>
</div>
</div>
<div id="cell-105" class="cell" data-execution_count="268">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kruskal-Wallis for col </span><span class="sc">{</span>chosen_cols[k]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>res_dfs[k]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kruskal-Wallis for col 年龄差</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="268">
<pre><code>KruskalResult(statistic=550.9540936771726, pvalue=6.360595079827829e-118)</code></pre>
</div>
</div>
<p>Kruskal-Wallis H-test tests的零假设是 不同组的中位数之间没有显著差异。 看来我们对于我们选中的三列，p值都特别小，说明我们可以拒绝零假设，认为这三列都会被“群类型”影响，导致中位数不相同。</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Open-Book-Studio\.github\.io\/THU-Coursework-Machine-Learning-for-Big-Data");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Open-Book-Studio/THU-Coursework-Machine-Learning-for-Big-Data/issues/new" class="toc-action"><i class="bi bi-github"></i>反馈问题</a></li></ul></div></div></div></footer></body></html>